<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Redirecting to Google login…</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="/haylo-auth.js"></script>
  <noscript>
    <meta http-equiv="refresh" content="0;url=/auth/google?redirect=/your-impact">
  </noscript>
  <script>
    (function () {
      function sanitizeRedirect(value, fallback) {
        if (!value) return fallback;
        try {
          var url = new URL(value, location.origin);
          if (url.origin !== location.origin) return fallback;
          return url.pathname + (url.search || '') + (url.hash || '');
        } catch (_) {
          return fallback;
        }
      }

      var desired = (window.HayloAuth && typeof window.HayloAuth.dash === 'function')
        ? window.HayloAuth.dash()
        : '/your-impact';
      var fallback = sanitizeRedirect(desired, '/your-impact');

      function go(target) {
        var safeTarget = sanitizeRedirect(target, fallback);
        if (!window.HayloAuth || typeof window.HayloAuth.login !== 'function') {
          location.replace('/auth/google?redirect=' + encodeURIComponent(safeTarget));
          return;
        }
        Promise.resolve(window.HayloAuth.login(safeTarget)).catch(function (error) {
          console.error('HayloAuth login failed', error);
          location.replace('/auth/google?redirect=' + encodeURIComponent(safeTarget));
        });
      }

      try {
        var params = new URLSearchParams(location.search);
        go(params.get('redirect'));
      } catch (error) {
        console.error('Login redirect failed', error);
        go(fallback);
      }
    })();
  </script>
</head>
<body>
  <p>Redirecting to Google login…</p>
</body>
</html>
